<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Free online chess clock</title>
<style>
  body { font-family: Arial, sans-serif; background:#071028; color:#e6eef8; display:flex; flex-direction:column; align-items:center; margin:0; padding:20px; }
  h1 { font-size:20px; }
  .container { display:flex; gap:20px; margin:20px 0; }
  .clock { background:#0b1220; padding:20px; border-radius:12px; width:180px; text-align:center; }
  .time { font-size:48px; font-weight:bold; }
  .small { font-size:14px; margin-top:4px; }
  button { margin:5px; padding:8px 12px; border:none; border-radius:8px; background:#1f2937; color:white; cursor:pointer; }
  button:hover { background:#374151; }
  input { width:80px; }
  #logBox { width:100%; max-width:500px; background:#071022; padding:10px; margin-top:12px; border-radius:8px; height:100px; overflow:auto; font-size:12px; }
  #settingsModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; }
  #settingsModal .modalContent { background:#0b1220; padding:20px; border-radius:12px; display:flex; flex-direction:column; gap:10px; width:300px; }
</style>
</head>
<body>
<h1>Free online chess clock</h1>
<div class="container">
  <div class="clock" id="leftClock">
    <div>Player A</div>
    <div class="time" id="leftTime">10:00.00</div>
    <div class="small" id="leftStatus">Start time: 10 minutes Increment: 0 seconds</div>
    <div class="small" id="leftStatus" style="display:none;">Status: ready</div>
  </div>
  <div class="clock" id="rightClock">
    <div>Player B</div>
    <div class="time" id="rightTime">10:00.00</div>
    <div class="small" id="rightStatus">Start time: 10 minutes Increment: 0 seconds</div>
    <div class="small" id="leftStatus" style="display:none;">Status: ready</div>
  </div>
</div>

<div>
  <button id="startBtn">Start</button>
  <button id="switchBtn">Switch</button>
  <button id="resetBtn">Reset (R)</button>
  <button id="settingsBtn">Settings</button>
  <button id="downloadLog" style="display:none;">Download CSV</button>
</div>

<div id="logBox" style="display:none;"></div>

<div id="settingsModal">
  <div class="modalContent">
    <div>Bro, you can't cheat by changing the time. Enter PIN to open settings:</div>
    <input type="password" id="pinInput" placeholder="PIN">
    <button id="pinSubmit">Submit</button>
    <button id="pinCancel">Cancel</button>
    <div id="pinMessage" style="color:red;font-size:12px;"></div>
    <div id="settingsPanel" style="display:none;">
      <div>
        <strong>Player A</strong><br>
        Initial min: <input type="number" id="left_init" value="10" step="0.5"><br>
        Increment (s): <input type="number" id="left_inc" value="0" step="0.1"><br>
        Rig multiplier (>1:00): <input type="number" id="left_mult" value="1" step="0.01" min="1">
      </div>
      <div>
        <strong>Player B</strong><br>
        Initial min: <input type="number" id="right_init" value="10" step="0.5"><br>
        Increment (s): <input type="number" id="right_inc" value="0" step="0.1"><br>
        Rig multiplier (>1:00): <input type="number" id="right_mult" value="1" step="0.01" min="1">
      </div>
      <button id="applySettings">Apply</button>
    </div>
  </div>
</div>

<script>
let leftTime = 10*60, rightTime = 10*60; 
let leftInc=0, rightInc=0, leftMult=1, rightMult=1; 
let active=null, timer=null, log=[]; 
let running=false;

const leftTimeEl=document.getElementById('leftTime');
const rightTimeEl=document.getElementById('rightTime');
const leftStatus=document.getElementById('leftStatus');
const rightStatus=document.getElementById('rightStatus');
const logBox=document.getElementById('logBox');

function formatTime(sec){
  let m=Math.floor(sec/60);
  let s=(sec%60).toFixed(2);
  if(s<10)s='0'+s;
  return `${m}:${s}`;
}

function updateDisplay(){
  leftTimeEl.textContent=formatTime(leftTime);
  rightTimeEl.textContent=formatTime(rightTime);
}

function logEvent(evt){ 
  const t=new Date().toLocaleTimeString(); 
  log.push([t,evt]); 
  logBox.textContent+=`${t}: ${evt}\n`; 
  logBox.scrollTop=logBox.scrollHeight;
}

function tick(){
  if(active==='left'){
    let factor=leftTime>60?leftMult:1;
    leftTime-=0.01*factor;
    if(leftTime<=0){leftTime=0; stopTimer(); leftStatus.textContent='Time out';}
  } else if(active==='right'){
    let factor=rightTime>60?rightMult:1;
    rightTime-=0.01*factor;
    if(rightTime<=0){rightTime=0; stopTimer(); rightStatus.textContent='Time out';}
  }
  updateDisplay();
}

function startTimer(){
  if(!running){running=true; logEvent('Clock started'); timer=setInterval(tick,10);}
}
function stopTimer(){running=false; clearInterval(timer); active=null;}

function switchClock(){
  if(!running) return;
  if(active==='left'){leftTime+=rightInc; active='right'; logEvent('Switched to right');}
  else if(active==='right'){rightTime+=leftInc; active='left'; logEvent('Switched to left');}
  updateDisplay();
}

function resetClock(){
  stopTimer();
  leftTime=document.getElementById('left_init').value*60;
  rightTime=document.getElementById('right_init').value*60;
  leftInc=parseFloat(document.getElementById('left_inc').value);
  rightInc=parseFloat(document.getElementById('right_inc').value);
  leftMult=parseFloat(document.getElementById('left_mult').value);
  rightMult=parseFloat(document.getElementById('right_mult').value);
  leftStatus.textContent='Status: ready';
  rightStatus.textContent='Status: ready';
  logEvent('Clock reset');
  updateDisplay();
}

document.getElementById('startBtn').addEventListener('click',()=>{active='left'; startTimer();});
document.getElementById('switchBtn').addEventListener('click',switchClock);
document.getElementById('resetBtn').addEventListener('click',resetClock);

document.addEventListener('keydown',(e)=>{
  if(e.code==='Space'){e.preventDefault(); if(running)switchClock(); else{active='left'; startTimer();}}
  if(e.code==='KeyR'){resetClock();}
});

const pinModal=document.getElementById('settingsModal');
const settingsPanel=document.getElementById('settingsPanel');
document.getElementById('settingsBtn').addEventListener('click',()=>{
  if(running){alert('Pause clock to access settings'); return;}
  pinModal.style.display='flex';
  settingsPanel.style.display='none';
  document.getElementById('pinInput').value='';
  document.getElementById('pinMessage').textContent='';
});

document.getElementById('pinCancel').addEventListener('click',()=>{pinModal.style.display='none';});
document.getElementById('pinSubmit').addEventListener('click',()=>{
  let val=document.getElementById('pinInput').value;
  if(val==='219847'){settingsPanel.style.display='block'; logEvent('PIN correct, settings opened');}
  else {document.getElementById('pinMessage').textContent='Incorrect PIN'; logEvent('PIN incorrect attempt');}
});

document.getElementById('applySettings').addEventListener('click',()=>{
  resetClock();
  pinModal.style.display='none';
});

document.getElementById('downloadLog').addEventListener('click',()=>{
  let csv='Time,Event\n'+log.map(a=>a.join(',')).join('\n');
  let blob=new Blob([csv],{type:'text/csv'});
  let url=URL.createObjectURL(blob);
  let a=document.createElement('a'); a.href=url; a.download='log.csv'; a.click(); URL.revokeObjectURL(url);
});

updateDisplay();
</script>
</body>
</html>
